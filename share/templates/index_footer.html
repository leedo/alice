? my ($app, $options, @windows) = @_;
        <script type="text/javascript">
          document.observe("dom:loaded", function () {
            alice.options = <?= Text::MicroTemplate::encoded_string(JSON::to_json $options, {ascii => 1}) ?>;

            // disable inline media and avatars on phones
            if (alice.isPhone) {
              alice.options.images = "hide";
              alice.options.avatars = "hide";
            }

            if (alice.options.avatars == "hide") $('container').addClassName('noavatars');

            <? my $tabsets = {map {$_->name => $_->windows } $app->tabsets}; ?>
            alice.tabsets = <?= Text::MicroTemplate::encoded_string(JSON::to_json $tabsets, {ascii => 1}) ?>;

            <? for my $window (@windows) { ?>
            alice.openWindow(
              <?= Text::MicroTemplate::encoded_string(JSON::to_json $window->serialized, {ascii => 1}) ?>
            );
            <? } ?>

            alice.ready();

            <? if (!$app->connected_ircs) { ?>
            alice.toggleConfig();
            <? } ?>
          });
        </script>
        <ul id="nicklist"></ul>
      </div>
      <ul id="controls">
        <li class="dropdown" id="tab_menu">
          <ul>
            <li class="submenu separate-bottom">Sets
              <?= $_mt->render_file('tabset_menu.html', $_[0]); ?>
            </li>
            <? for my $window (@windows) { ?>
              <?= $_mt->render_file('select.html', $_[0], $window); ?>
            <? } ?>
          </ul>
        </li>
        <li class="dropdown" id="config_menu">
          <ul>
            <? if ($app->auth_enabled) { ?>
            <li>Logout</li>
            <? } ?>
            <li>Help</li>
            <li>Preferences</li>
            <li>Connections</li>
          </ul>
        </li>
        <li id="connection_status" class="ok"></li>
      </ul>
      <div id="tab_container">
        <ul id="tabs">
        <? for my $window (@windows) { ?>
          <?= $_mt->render_file('tab.html', $_[0], $window) ?>
        <? } ?>
        </ul>
      </div>
      <div id="input">
        <form autocomplete="off">
          <input type="hidden" value="" name="source" id="source" />
          <div class="textarea_wrap"><textarea name="msg" id="msg" rows="1" autocapitalize="off"></textarea></div>
          <input type="submit" id="submit" class="send" value="Send">
        </form>
      </div>
    </div>
    <?= $_mt->render_file('help.html', $_[0]) ?>
  </body>
</html>
